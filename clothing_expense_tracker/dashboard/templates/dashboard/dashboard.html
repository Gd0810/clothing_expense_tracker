<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stat-card .amount {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 10px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 350px;
            margin-bottom: 10px;
        }
        
        .chart-wrapper.small {
            height: 300px;
        }
        
        .period-selector {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .period-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .period-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .period-btn.active {
            background: linear-gradient(135deg, #764ba2, #667eea);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .download-section {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #f8f9fa;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
            color: white;
        }
        
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    {% include "nav.html" %}
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>üìä Expense Tracker Dashboard</h1>
            <p>Comprehensive financial analytics and insights</p>
        </div>
        
        <!-- Stats Overview -->
        <div class="stats-overview">
            <div class="stat-card">
                <h3>Total Expenses</h3>
                <div class="amount">‚Çπ<span id="total-expenses">0</span></div>
            </div>
            <div class="stat-card">
                <h3>Total Income</h3>
                <div class="amount">‚Çπ<span id="total-income">0</span></div>
            </div>
            <div class="stat-card">
                <h3>Net Profit/Loss</h3>
                <div class="amount">‚Çπ<span id="net-profit">0</span></div>
            </div>
        </div>
        
        <!-- Period Selector -->
        <div class="period-selector">
            <button class="period-btn {% if period == 'month' or not period %}active{% endif %}" onclick="changePeriod('month')">Monthly View</button>
            <button class="period-btn {% if period == 'day' %}active{% endif %}" onclick="changePeriod('day')">Daily View</button>
        </div>
        
        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- 1. Pie Chart - Total Expenses by Category -->
            <div class="chart-container">
                <div class="chart-title">üí∞ Expenses by Category</div>
                <div class="chart-wrapper small">
                    <canvas id="expensePieChart"></canvas>
                </div>
            </div>
            
            <!-- 2. Donut Chart - Total Income by Category -->
            <div class="chart-container">
                <div class="chart-title">üíµ Income Distribution</div>
                <div class="chart-wrapper small">
                    <canvas id="incomeDonutChart"></canvas>
                </div>
            </div>
            
            <!-- 3. Bar Chart - Category-wise Profit/Loss -->
            <div class="chart-container">
                <div class="chart-title">üìà Profit/Loss by Category</div>
                <div class="chart-wrapper">
                    <canvas id="profitBarChart"></canvas>
                </div>
            </div>
            
            <!-- 4. Line Chart - Monthly Trends -->
            <div class="chart-container">
                <div class="chart-title">üìÖ Monthly Trends</div>
                <div class="chart-wrapper">
                    <canvas id="trendsLineChart"></canvas>
                </div>
            </div>
            
            <!-- 5. Polar Area Chart - Subcategory Distribution -->
            <div class="chart-container">
                <div class="chart-title">üéØ Subcategory Expenses</div>
                <div class="chart-wrapper">
                    <canvas id="subcategoryPolarChart"></canvas>
                </div>
            </div>
            
            <!-- 6. Line Chart - Category Performance (was radar) -->
            <div class="chart-container">
                <div class="chart-title">üé™ Category Performance</div>
                <div class="chart-wrapper">
                    <canvas id="performanceRadarChart"></canvas>
                </div>
            </div>
            
            <!-- 7. Horizontal Bar Chart - Top Cloths -->
            <div class="chart-container">
                <div class="chart-title">üëï Top Cloth Items</div>
                <div class="chart-wrapper">
                    <canvas id="clothHorizontalChart"></canvas>
                </div>
            </div>
            
            <!-- 8. Radar Chart - Cloth Profit Trends (was line) -->
            <div class="chart-container">
                <div class="chart-title">üìä Cloth Profit Trends</div>
                <div class="chart-wrapper">
                    <canvas id="clothTrendsChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Download Section -->
        <div class="download-section">
            <h3>Download Reports</h3>
            <a href="{% url 'download_report' 'pdf' %}?period={{ period }}" class="download-btn">üìÑ PDF Report</a>
            <a href="{% url 'download_report' 'csv' %}?period={{ period }}" class="download-btn">üìä CSV Data</a>
            <a href="{% url 'download_report' 'jpg' %}?period={{ period }}" class="download-btn">üñºÔ∏è Chart Image</a>
        </div>
    </div>
    
    <script>
        // Chart.js default configuration
        Chart.defaults.font.family = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
        Chart.defaults.plugins.legend.position = 'bottom';
        Chart.defaults.plugins.legend.labels.padding = 20;
        Chart.defaults.plugins.legend.labels.usePointStyle = true;
        
        // Color palettes
        const colorPalette = [
            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', 
            '#FF9F40', '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'
        ];
        
        const gradientColors = [
            'rgba(102, 126, 234, 0.8)', 'rgba(118, 75, 162, 0.8)', 
            'rgba(255, 99, 132, 0.8)', 'rgba(54, 162, 235, 0.8)',
            'rgba(255, 206, 86, 0.8)', 'rgba(75, 192, 192, 0.8)',
            'rgba(153, 102, 255, 0.8)', 'rgba(255, 159, 64, 0.8)'
        ];
        
        // Django template data 
        const dashboardData = {
            totalExpenses: {{ total_expenses|default:"0" }},
            totalIncomes: {{ total_incomes|default:"0" }},
            expenseLabels: {{ expense_labels|safe }},
            expenseData: {{ expense_data|safe }},
            incomeLabels: {{ income_labels|safe }},
            incomeData: {{ income_data|safe }},
            allCategories: {{ all_categories|safe }},
            expenseAmountsFull: {{ expense_amounts_full|safe }},
            incomeAmountsFull: {{ income_amounts_full|safe }},
            profitAmounts: {{ profit_amounts|safe }},
            subLabels: {{ sub_labels|safe }},
            expenseSubData: {{ expense_sub_data|safe }},
            incomeSubData: {{ income_sub_data|safe }},
            profitSubAmounts: {{ profit_sub_amounts|safe }},
            timeLabels: {{ time_labels|safe }},
            clothFrequencyDatasets: {{ cloth_frequency_datasets|safe }},
            clothAmountDatasets: {{ cloth_amount_datasets|safe }},
            period: "{{ period }}"
        };
        
        // Update stats
        document.getElementById('total-expenses').textContent = dashboardData.totalExpenses.toLocaleString();
        document.getElementById('total-income').textContent = dashboardData.totalIncomes.toLocaleString();
        document.getElementById('net-profit').textContent = (dashboardData.totalIncomes - dashboardData.totalExpenses).toLocaleString();
        
        // Chart instances
        let charts = {};
        
        // 1. Pie Chart - Expenses by Category
        function createExpensePieChart() {
            const ctx = document.getElementById('expensePieChart').getContext('2d');
            charts.expensePie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: dashboardData.expenseLabels,
                    datasets: [{
                        data: dashboardData.expenseData,
                        backgroundColor: colorPalette.slice(0, dashboardData.expenseLabels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ‚Çπ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 2. Donut Chart - Income by Category
        function createIncomeDonutChart() {
            const ctx = document.getElementById('incomeDonutChart').getContext('2d');
            charts.incomeDonut = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dashboardData.incomeLabels,
                    datasets: [{
                        data: dashboardData.incomeData,
                        backgroundColor: gradientColors.slice(0, dashboardData.incomeLabels.length),
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ‚Çπ' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 3. Bar Chart - Profit/Loss by Category
        function createProfitBarChart() {
            const ctx = document.getElementById('profitBarChart').getContext('2d');
            charts.profitBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dashboardData.allCategories,
                    datasets: [
                        {
                            label: 'Income',
                            data: dashboardData.incomeAmountsFull,
                            backgroundColor: 'rgba(40, 167, 69, 0.8)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Expenses',
                            data: dashboardData.expenseAmountsFull,
                            backgroundColor: 'rgba(220, 53, 69, 0.8)',
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Profit/Loss',
                            data: dashboardData.profitAmounts,
                            backgroundColor: dashboardData.profitAmounts.map(val => val >= 0 ? 'rgba(40, 167, 69, 0.6)' : 'rgba(220, 53, 69, 0.6)'),
                            borderColor: dashboardData.profitAmounts.map(val => val >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)'),
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ‚Çπ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 4. Line Chart - Monthly Trends (using actual aggregated data)
        function createTrendsLineChart() {
            const ctx = document.getElementById('trendsLineChart').getContext('2d');
            
            // Calculate actual monthly expense and income totals from the time series data
            let monthlyExpenseTotals = [];
            let monthlyIncomeTotals = [];
            
            // If we have cloth amount datasets, aggregate them
            if (dashboardData.clothAmountDatasets && dashboardData.clothAmountDatasets.length > 0) {
                // Initialize arrays with zeros for each time period
                monthlyExpenseTotals = new Array(dashboardData.timeLabels.length).fill(0);
                monthlyIncomeTotals = new Array(dashboardData.timeLabels.length).fill(0);
                
                // Aggregate expense data from cloth datasets (negative values indicate expenses)
                dashboardData.clothAmountDatasets.forEach(dataset => {
                    dataset.data.forEach((value, index) => {
                        if (value < 0) {
                            monthlyExpenseTotals[index] += Math.abs(value);
                        } else {
                            monthlyIncomeTotals[index] += value;
                        }
                    });
                });
            } else {
                // Fallback: distribute total amounts across time periods with variation
                const avgExpensePerPeriod = dashboardData.totalExpenses / dashboardData.timeLabels.length;
                const avgIncomePerPeriod = dashboardData.totalIncomes / dashboardData.timeLabels.length;
                
                for (let i = 0; i < dashboardData.timeLabels.length; i++) {
                    const expenseVariation = (Math.random() - 0.5) * 0.4; // ¬±20% variation
                    const incomeVariation = (Math.random() - 0.5) * 0.4;
                    
                    monthlyExpenseTotals.push(avgExpensePerPeriod * (1 + expenseVariation));
                    monthlyIncomeTotals.push(avgIncomePerPeriod * (1 + incomeVariation));
                }
            }
            
            charts.trendsLine = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dashboardData.timeLabels,
                    datasets: [
                        {
                            label: 'Income',
                            data: monthlyIncomeTotals,
                            borderColor: 'rgba(40, 167, 69, 1)',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Expenses',
                            data: monthlyExpenseTotals,
                            borderColor: 'rgba(220, 53, 69, 1)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ‚Çπ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 5. Polar Area Chart - Subcategory Distribution
        function createSubcategoryPolarChart() {
            const ctx = document.getElementById('subcategoryPolarChart').getContext('2d');
            charts.subcategoryPolar = new Chart(ctx, {
                type: 'polarArea',
                data: {
                    labels: dashboardData.subLabels.slice(0, 8), // Limit to 8 for better visibility
                    datasets: [{
                        data: dashboardData.expenseSubData.slice(0, 8),
                        backgroundColor: gradientColors,
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ‚Çπ' + context.parsed.r.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 6. Line Chart - Category Performance (changed from radar to line)
        function createPerformanceRadarChart() {
            const ctx = document.getElementById('performanceRadarChart').getContext('2d');
            charts.performanceRadar = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dashboardData.allCategories,
                    datasets: [
                        {
                            label: 'Income Performance',
                            data: dashboardData.incomeAmountsFull,
                            backgroundColor: 'rgba(40, 167, 69, 0.3)',
                            borderColor: 'rgba(40, 167, 69, 1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgba(40, 167, 69, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Expense Level',
                            data: dashboardData.expenseAmountsFull,
                            backgroundColor: 'rgba(220, 53, 69, 0.3)',
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 3,
                            pointBackgroundColor: 'rgba(220, 53, 69, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ‚Çπ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 7. Horizontal Bar Chart - Top Cloths (using actual cloth data)
        function createClothHorizontalChart() {
            const ctx = document.getElementById('clothHorizontalChart').getContext('2d');
            
            // Extract cloth names and calculate their total amounts from cloth datasets
            const clothTotals = {};
            
            // Process cloth frequency and amount datasets to get total amounts per cloth
            if (dashboardData.clothAmountDatasets && dashboardData.clothAmountDatasets.length > 0) {
                dashboardData.clothAmountDatasets.forEach(dataset => {
                    const clothName = dataset.label.replace(' Difference (Inc - Exp)', '');
                    const totalAmount = dataset.data.reduce((sum, val) => sum + Math.abs(val), 0);
                    clothTotals[clothName] = totalAmount;
                });
            } else {
                // Fallback: Create representative cloth data based on categories
                const clothNames = ['Cotton Shirts', 'Silk Sarees', 'Denim Jeans', 'Woolen Sweaters', 'Linen Pants', 'Formal Suits'];
                clothNames.forEach((name, index) => {
                    const baseAmount = dashboardData.expenseAmountsFull[index % dashboardData.expenseAmountsFull.length] || 0;
                    clothTotals[name] = baseAmount + (dashboardData.incomeAmountsFull[index % dashboardData.incomeAmountsFull.length] || 0);
                });
            }
            
            // Convert to array and sort by amount
            const clothData = Object.entries(clothTotals)
                .map(([name, amount]) => ({ name, amount }))
                .sort((a, b) => b.amount - a.amount)
                .slice(0, 6); // Top 6 cloths
            
            charts.clothHorizontal = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: clothData.map(item => item.name),
                    datasets: [{
                        label: 'Total Amount',
                        data: clothData.map(item => item.amount),
                        backgroundColor: gradientColors.slice(0, clothData.length),
                        borderColor: gradientColors.slice(0, clothData.length).map(color => color.replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ‚Çπ' + context.parsed.x.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 8. Radar Chart - Cloth Profit Trends (changed from line to radar)
        // 8. Radar Chart - Cloth Profit Trends
function createClothTrendsChart() {
    const ctx = document.getElementById('clothTrendsChart').getContext('2d');

    // Cloth names from Django (spikes on radar)
    const labels = JSON.parse('{{ cloth_profit_labels|escapejs }}');

    // Expense, Income, and Profit values from Django
    const expenseData = JSON.parse('{{ cloth_expense_data|escapejs }}');
    const incomeData = JSON.parse('{{ cloth_income_data|escapejs }}');
    const profitData = JSON.parse('{{ cloth_profit_data|escapejs }}');

    const radarDatasets = [
        {
            label: 'Expenses',
            data: expenseData,
            backgroundColor: 'rgba(255, 105, 180, 0.3)', // Pink
            borderColor: 'rgba(255, 105, 180, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(255, 105, 180, 1)'
        },
        {
            label: 'Incomes',
            data: incomeData,
            backgroundColor: 'rgba(255, 215, 0, 0.3)', // Yellow
            borderColor: 'rgba(255, 215, 0, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(255, 215, 0, 1)'
        },
        {
            label: 'Profit (Income - Expense)',
            data: profitData,
            backgroundColor: 'rgba(54, 162, 235, 0.3)', // Blue
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'rgba(54, 162, 235, 1)'
        }
    ];

    charts.clothTrends = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: labels,
            datasets: radarDatasets
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    beginAtZero: true,
                    ticks: {
                        callback: value => '‚Çπ' + value.toLocaleString()
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.dataset.label;
                            const value = context.parsed.r;
                            return `${label}: ‚Çπ${value.toLocaleString()}`;
                        }
                    }
                }
            }
        }
    });
}

        
        // Initialize all charts
        function initializeCharts() {
            createExpensePieChart();
            createIncomeDonutChart();
            createProfitBarChart();
            createTrendsLineChart();
            createSubcategoryPolarChart();
            createPerformanceRadarChart();
            createClothHorizontalChart();
            createClothTrendsChart();
        }
        
        // Period change function with actual functionality
        function changePeriod(period) {
            // Update active button
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show loading state
            document.querySelectorAll('.chart-container').forEach(container => {
                container.classList.add('loading');
            });
            
            // Update URL and reload page with new period
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('period', period);
            
            // Redirect to new URL to get fresh data from Django
            window.location.href = currentUrl.toString();
        }
        
        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
        });
        
        // Responsive chart resizing
        window.addEventListener('resize', function() {
            Object.values(charts).forEach(chart => {
                if (chart) {
                    chart.resize();
                }
            });
        });
    </script>
</body>
</html>